Plus
  ::= "+" as Plus
  ;

Lt
  ::= "<" as Lt
  ;

Gt
  ::= ">" as Gt
  ;

EqualOptional
  ::= "optional" [Plus:optional] "+" {Plus:loop} as OptionalFeature {priority = Equal}
  ;

PositiveOptional
  ::= "positive_optional" +[Plus:optional] "+" {Plus:loop} as OptionalFeature {priority = PreferTake}
  ;

NegativeOptional
  ::= "negative_optional" -[Plus:optional] "+" {Plus:loop} as OptionalFeature {priority = PreferSkip}
  ;

NO1
  ::= [Plus:optional] Plus:tail1 as partial NestedOptionalFeature
  ;

PositiveNO1
  ::= +[Plus:optional] Plus:tail1 as partial NestedOptionalFeature
  ;

NegativeNO1
  ::= -[Plus:optional] Plus:tail1 as partial NestedOptionalFeature
  ;

NO2
  ::= [NO1] Plus:tail2 as partial NestedOptionalFeature
  ;

PositiveNO2
  ::= +[PositiveNO1] Plus:tail2 as partial NestedOptionalFeature
  ;

NegativeNO2
  ::= -[NegativeNO1] Plus:tail2 as partial NestedOptionalFeature
  ;

NestedOptional
  ::= "nested_optional" [NO2] Plus:tail3 {Plus:tails} as NestedOptionalFeature
  ;

NestedPositiveOptional
  ::= "nested_positive_optional" +[PositiveNO2] Plus:tail3 {Plus:tails} as NestedOptionalFeature
  ;

NestedNegativeOptional
  ::= "nested_negative_optional" -[NegativeNO2] Plus:tail3 {Plus:tails} as NestedOptionalFeature
  ;

BranchedOptional
  ::= "branched_optional" +[Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = Plus}
  ::= "branched_optional" -[Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = Minus}
  ::= "branched_optional" [Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = NoCompetition}
  ;

PbaGts
  ::= Gt:gts {Gt:gts} as partial PbaFeature
  ;

Pba
  ::= "prefix_before_ambiguity" {Lt:lts} PbaGts [Plus:optional] Plus {Plus:tails} as PbaFeature
  ;

Module
  ::= !EqualOptional
  ::= !PositiveOptional
  ::= !NegativeOptional
  ::= !NestedOptional
  ::= !NestedPositiveOptional
  ::= !NestedNegativeOptional
  ::= !BranchedOptional
  ::= "entry_rule_priority" +[Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = Plus}
  ::= "entry_rule_priority" -[Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = Minus}
  ::= "entry_rule_priority" [Plus:optional] Plus {Plus:tails} as BranchedOptionalFeature {type = NoCompetition}
  ::= !Pba
  ;
